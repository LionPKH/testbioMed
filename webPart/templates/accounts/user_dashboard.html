<!-- ============================================ -->
<!-- templates/accounts/user_dashboard.html -->
<!-- ============================================ -->
{% extends 'base.html' %}

{% block title %}–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å{% endblock %}

{% block content %}
<div class="card">
    <h1 style="color: #333; margin-bottom: 30px;">
        üë§ –ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å
    </h1>
    
    <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 30px;">
        <div style="text-align: center;">
            {% if profile.avatar %}
                <img src="{{ profile.avatar.url }}" alt="Avatar" 
                     style="width: 200px; height: 200px; border-radius: 50%; object-fit: cover; border: 5px solid #667eea;">
            {% else %}
                <div style="width: 200px; height: 200px; border-radius: 50%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
                            display: flex; align-items: center; justify-content: center; margin: 0 auto;">
                    <span style="font-size: 80px; color: white;">{{ user.username.0|upper }}</span>
                </div>
            {% endif %}
            
            <h2 style="margin-top: 20px; color: #333;">{{ user.username }}</h2>
            <p style="color: #666;">{{ user.email }}</p>
            
            <div style="margin-top: 20px; padding: 10px; background: {% if profile.subscription_active %}#d4edda{% else %}#f8d7da{% endif %}; 
                        border-radius: 8px;">
                <strong>–ü–æ–¥–ø–∏—Å–∫–∞: 
                    {% if profile.subscription_active %}
                        <span style="color: #155724;">‚úì –ê–∫—Ç–∏–≤–Ω–∞</span>
                    {% else %}
                        <span style="color: #721c24;">‚úó –ù–µ–∞–∫—Ç–∏–≤–Ω–∞</span>
                    {% endif %}
                </strong>
            </div>
        </div>
        
        <div style="background: #f8f9fa; padding: 25px; border-radius: 10px;">
            <h2 style="color: #333; margin-bottom: 20px;">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h2>
            
            <div style="display: grid; grid-template-columns: 150px 1fr; gap: 15px;">
                <strong>–ë–∏–æ–≥—Ä–∞—Ñ–∏—è:</strong>
                <span>{{ profile.bio|default:"–ù–µ —É–∫–∞–∑–∞–Ω–∞" }}</span>
                
                <strong>–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è:</strong>
                <span>{{ profile.birth_date|date:"d.m.Y"|default:"–ù–µ —É–∫–∞–∑–∞–Ω–∞" }}</span>
                
                <strong>–¢–µ–ª–µ—Ñ–æ–Ω:</strong>
                <span>{{ profile.phone|default:"–ù–µ —É–∫–∞–∑–∞–Ω" }}</span>
                
                <strong>–ì–æ—Ä–æ–¥:</strong>
                <span>{{ profile.city|default:"–ù–µ —É–∫–∞–∑–∞–Ω" }}</span>
                
                <strong>–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:</strong>
                <span>{{ profile.created_at|date:"d.m.Y" }}</span>
            </div>
        </div>
    </div>
    
    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞–¥–∞—á -->
    {% if statistics %}
    <div style="margin-top: 30px; background: #f8f9fa; padding: 25px; border-radius: 10px;">
        <h2 style="color: #333; margin-bottom: 20px;">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞–¥–∞—á</h2>
        
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 20px;">
            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 15px; border-radius: 8px; color: white; text-align: center;">
                <div style="font-size: 28px; font-weight: bold;">{{ statistics.total_tasks|default:0 }}</div>
                <div style="margin-top: 5px; font-size: 14px;">–í—Å–µ–≥–æ –∑–∞–¥–∞—á</div>
            </div>
            
            <div style="background: linear-gradient(135deg, #56ab2f 0%, #a8e063 100%); padding: 15px; border-radius: 8px; color: white; text-align: center;">
                <div style="font-size: 28px; font-weight: bold;">{{ statistics.completed_tasks|default:0 }}</div>
                <div style="margin-top: 5px; font-size: 14px;">‚úì –í—ã–ø–æ–ª–Ω–µ–Ω–æ</div>
            </div>
            
            <div style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); padding: 15px; border-radius: 8px; color: white; text-align: center;">
                <div style="font-size: 28px; font-weight: bold;">{{ statistics.failed_tasks|default:0 }}</div>
                <div style="margin-top: 5px; font-size: 14px;">‚úó –û—à–∏–±–∫–∏</div>
            </div>
            
            <div style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); padding: 15px; border-radius: 8px; color: white; text-align: center;">
                <div style="font-size: 28px; font-weight: bold;">{{ statistics.running_tasks|default:0 }}</div>
                <div style="margin-top: 5px; font-size: 14px;">‚ñ∂ –í –ø—Ä–æ—Ü–µ—Å—Å–µ</div>
            </div>
            
            <div style="background: linear-gradient(135deg, #ffa751 0%, #ffe259 100%); padding: 15px; border-radius: 8px; color: white; text-align: center;">
                <div style="font-size: 28px; font-weight: bold;">{{ statistics.pending_tasks|default:0 }}</div>
                <div style="margin-top: 5px; font-size: 14px;">‚è≥ –í –æ—á–µ—Ä–µ–¥–∏</div>
            </div>
        </div>
    </div>
    {% endif %}
    
    <!-- –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–¥–∞—á–∏ -->
    {% if recent_tasks %}
    <div style="margin-top: 30px; background: #f8f9fa; padding: 25px; border-radius: 10px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h2 style="color: #333; margin: 0;">üìã –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–¥–∞—á–∏</h2>
            <a href="{% url 'my_tasks' %}" style="color: #667eea; text-decoration: none; font-weight: 500;">
                –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ ‚Üí
            </a>
        </div>
        
        <div style="overflow-x: auto;">
            <table style="width: 100%; border-collapse: collapse;">
                <thead>
                    <tr style="background: #667eea; color: white;">
                        <th style="padding: 10px; text-align: left; border: 1px solid #ddd;">–§–∞–π–ª</th>
                        <th style="padding: 10px; text-align: left; border: 1px solid #ddd;">–°–æ–∑–¥–∞–Ω–æ</th>
                        <th style="padding: 10px; text-align: center; border: 1px solid #ddd;">–°—Ç–∞—Ç—É—Å</th>
                        <th style="padding: 10px; text-align: center; border: 1px solid #ddd;">–î–µ–π—Å—Ç–≤–∏—è</th>
                    </tr>
                </thead>
                <tbody>
                    {% for task in recent_tasks %}
                    <tr style="border-bottom: 1px solid #ddd; {% if forloop.counter|divisibleby:2 %}background: #ffffff;{% else %}background: #f8f9fa;{% endif %}">
                        <td style="padding: 10px; border: 1px solid #ddd;">
                            <strong>{{ task.original_filename }}</strong>
                        </td>
                        <td style="padding: 10px; border: 1px solid #ddd;">
                            {{ task.timestamp_utc|date:"d.m.Y H:i" }}
                        </td>
                        <td style="padding: 10px; text-align: center; border: 1px solid #ddd;">
                            {% if task.status == 'completed' %}
                                <span style="background: #28a745; color: white; padding: 4px 8px; border-radius: 4px; font-size: 11px;">
                                    ‚úì –í—ã–ø–æ–ª–Ω–µ–Ω–æ
                                </span>
                            {% elif task.status == 'failed' %}
                                <span style="background: #dc3545; color: white; padding: 4px 8px; border-radius: 4px; font-size: 11px;">
                                    ‚úó –û—à–∏–±–∫–∞
                                </span>
                            {% elif task.status == 'running' %}
                                <span style="background: #17a2b8; color: white; padding: 4px 8px; border-radius: 4px; font-size: 11px;">
                                    ‚ñ∂ –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è
                                </span>
                            {% elif task.status == 'pending' %}
                                <span style="background: #ffc107; color: #333; padding: 4px 8px; border-radius: 4px; font-size: 11px;">
                                    ‚è≥ –í –æ—á–µ—Ä–µ–¥–∏
                                </span>
                            {% else %}
                                <span style="background: #e0e0e0; color: #333; padding: 4px 8px; border-radius: 4px; font-size: 11px;">
                                    ‚Äî –ù–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
                                </span>
                            {% endif %}
                        </td>
                        <td style="padding: 10px; text-align: center; border: 1px solid #ddd;">
                            <a href="{% url 'task_detail' task.task_id %}" 
                               style="color: #667eea; text-decoration: none; font-size: 13px;">
                                üëÅ –ü–æ–¥—Ä–æ–±–Ω–µ–µ
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% endif %}
    
    <div style="margin-top: 30px; display: flex; gap: 10px; flex-wrap: wrap;">
        <a href="{% url 'user_profile_edit' %}" class="btn btn-primary">
            –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å
        </a>
        <a href="{% url 'submit_task' %}" class="btn btn-secondary">
            ‚ûï –ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞
        </a>
        <a href="{% url 'my_tasks' %}" class="btn btn-secondary">
            üìã –í—Å–µ –∑–∞–¥–∞—á–∏
        </a>
    </div>
</div>
{% endblock %}