{% extends 'base.html' %}

{% block title %}–ó–∞–¥–∞—á–∞: {{ task.original_filename }}{% endblock %}

{% block content %}
<div class="card">
    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è –Ω–∞–∑–∞–¥ -->
    <div style="margin-bottom: 20px;">
        <a href="{% url 'my_tasks' %}" style="color: #667eea; text-decoration: none;">
            ‚Üê –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É –∑–∞–¥–∞—á
        </a>
    </div>
    
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
    <h1 style="color: #333; margin-bottom: 10px;">
        üìÑ {{ task.original_filename }}
    </h1>
    <p style="color: #666; margin-bottom: 30px;">
        ID –∑–∞–¥–∞—á–∏: <code>{{ task.task_id }}</code>
    </p>
    
    <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
    <div style="background: #f8f9fa; padding: 25px; border-radius: 10px; margin-bottom: 30px;">
        <h2 style="color: #333; margin-bottom: 20px;">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–¥–∞—á–µ</h2>
        
        <div style="display: grid; grid-template-columns: 200px 1fr; gap: 15px;">
            <strong>–§–∞–π–ª –Ω–∞ –¥–∏—Å–∫–µ:</strong>
            <span><code>{{ task.task_payload }}</code></span>
            
            <strong>–ü—É—Ç—å –∫ —Ñ–∞–π–ª—É:</strong>
            <span style="word-break: break-all;"><code>{{ task.file_path }}</code></span>
            
            <strong>–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:</strong>
            <span>{{ task.timestamp_utc|date:"d.m.Y H:i:s" }}</span>
            
            <strong>–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:</strong>
            <span>{{ task.updated_at|date:"d.m.Y H:i:s" }}</span>
        </div>
    </div>
    
    <!-- Python –∫–æ–¥ -->
    <div style="background: #1e1e1e; padding: 25px; border-radius: 10px; margin-bottom: 30px;">
        <h2 style="color: #d4d4d4; margin-bottom: 20px;">Python –∫–æ–¥</h2>
        <pre style="color: #d4d4d4; font-family: 'Courier New', monospace; overflow-x: auto; margin: 0; line-height: 1.5;"><code>{{ task.python_code }}</code></pre>
    </div>
    
    <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è -->
    <div style="background: #f8f9fa; padding: 25px; border-radius: 10px; margin-bottom: 30px;">
        <h2 style="color: #333; margin-bottom: 20px;">
            –ò—Å—Ç–æ—Ä–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è 
            {% if results %}
                <span style="color: #666; font-size: 16px;">({{ results|length }} –∑–∞–ø—É—Å–∫{% if results|length > 1 %}–æ–≤{% elif results|length == 1 %}{% else %}–æ–≤{% endif %})</span>
            {% endif %}
        </h2>
        
        {% if results %}
            {% for result in results %}
            <div style="border: 2px solid #ddd; border-radius: 10px; padding: 20px; margin-bottom: 20px; 
                        {% if result.status == 'completed' %}background: #d4edda; border-color: #28a745;
                        {% elif result.status == 'failed' or result.status == 'error' %}background: #f8d7da; border-color: #dc3545;
                        {% elif result.status == 'running' %}background: #d1ecf1; border-color: #17a2b8;
                        {% elif result.status == 'pending' %}background: #fff3cd; border-color: #ffc107;
                        {% else %}background: #e2e3e5; border-color: #6c757d;{% endif %}">
                
                <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ -->
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h3 style="margin: 0; color: #333;">
                        –ó–∞–ø—É—Å–∫ #{{ forloop.counter }}
                    </h3>
                    <div>
                        {% if result.status == 'completed' %}
                            <span style="background: #28a745; color: white; padding: 8px 15px; border-radius: 5px; font-weight: bold;">
                                ‚úì –í—ã–ø–æ–ª–Ω–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ
                            </span>
                        {% elif result.status == 'failed' %}
                            <span style="background: #dc3545; color: white; padding: 8px 15px; border-radius: 5px; font-weight: bold;">
                                ‚úó –û—à–∏–±–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
                            </span>
                        {% elif result.status == 'running' %}
                            <span style="background: #17a2b8; color: white; padding: 8px 15px; border-radius: 5px; font-weight: bold;">
                                ‚ñ∂ –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è
                            </span>
                        {% elif result.status == 'pending' %}
                            <span style="background: #ffc107; color: #333; padding: 8px 15px; border-radius: 5px; font-weight: bold;">
                                ‚è≥ –í –æ—á–µ—Ä–µ–¥–∏
                            </span>
                        {% elif result.status == 'error' %}
                            <span style="background: #6c757d; color: white; padding: 8px 15px; border-radius: 5px; font-weight: bold;">
                                ‚ö† –°–∏—Å—Ç–µ–º–Ω–∞—è –æ—à–∏–±–∫–∞
                            </span>
                        {% else %}
                            <span style="background: #e0e0e0; color: #333; padding: 8px 15px; border-radius: 5px; font-weight: bold;">
                                {{ result.status|upper }}
                            </span>
                        {% endif %}
                    </div>
                </div>
                
                <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ -->
                <div style="display: grid; grid-template-columns: 150px 1fr; gap: 10px; margin-bottom: 15px; color: #333;">
                    <strong>–í—Ä–µ–º—è –∑–∞–ø—É—Å–∫–∞:</strong>
                    <span>{{ result.created_at|date:"d.m.Y H:i:s" }}</span>
                    
                    {% if result.execution_time_seconds %}
                    <strong>–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:</strong>
                    <span>{{ result.execution_time_seconds }} —Å–µ–∫—É–Ω–¥</span>
                    {% endif %}
                </div>
                
                <!-- –†–µ—à–µ–Ω–∏–µ/—Ä–µ–∑—É–ª—å—Ç–∞—Ç -->
                {% if result.solution %}
                <div style="margin-bottom: 15px;">
                    <strong style="color: #333; display: block; margin-bottom: 5px;">–†–µ–∑—É–ª—å—Ç–∞—Ç:</strong>
                    <div style="background: white; padding: 15px; border-radius: 5px; border: 1px solid #ddd;">
                        {{ result.solution }}
                    </div>
                </div>
                {% endif %}
                
                <!-- –í—ã–≤–æ–¥ –ø—Ä–æ–≥—Ä–∞–º–º—ã -->
                {% if result.output %}
                <div style="margin-bottom: 15px;">
                    <strong style="color: #333; display: block; margin-bottom: 5px;">–í—ã–≤–æ–¥ –ø—Ä–æ–≥—Ä–∞–º–º—ã (stdout):</strong>
                    <pre style="background: #1e1e1e; color: #d4d4d4; padding: 15px; border-radius: 5px; overflow-x: auto; margin: 0; font-family: 'Courier New', monospace;"><code>{{ result.output }}</code></pre>
                </div>
                {% endif %}
                
                <!-- –û—à–∏–±–∫–∞ -->
                {% if result.error_message %}
                <div style="margin-bottom: 0;">
                    <strong style="color: #721c24; display: block; margin-bottom: 5px;">–°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ:</strong>
                    <pre style="background: #f5c6cb; color: #721c24; padding: 15px; border-radius: 5px; overflow-x: auto; margin: 0; font-family: 'Courier New', monospace; border: 1px solid #f1aeb5;"><code>{{ result.error_message }}</code></pre>
                </div>
                {% endif %}
            </div>
            {% endfor %}
        {% else %}
            <div style="text-align: center; padding: 40px; background: white; border-radius: 10px; border: 2px dashed #ddd;">
                <div style="font-size: 60px; margin-bottom: 15px;">‚è∏</div>
                <h3 style="color: #666; margin-bottom: 10px;">–ó–∞–¥–∞—á–∞ –µ—â–µ –Ω–µ –≤—ã–ø–æ–ª–Ω—è–ª–∞—Å—å</h3>
                <p style="color: #999;">
                    –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –∑–∞–¥–∞—á–∏
                </p>
            </div>
        {% endif %}
    </div>
    
    <!-- –î–µ–π—Å—Ç–≤–∏—è -->
    <div style="display: flex; gap: 10px;">
        <a href="{% url 'my_tasks' %}" class="btn btn-secondary">
            ‚Üê –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É
        </a>
        <a href="{% url 'submit_task' %}" class="btn btn-primary">
            ‚ûï –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –∑–∞–¥–∞—á—É
        </a>
    </div>
</div>

<style>
    /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–æ–¥–∞ */
    code {
        background: #f4f4f4;
        padding: 2px 6px;
        border-radius: 3px;
        font-family: 'Courier New', monospace;
        font-size: 14px;
    }
    
    pre code {
        background: transparent;
        padding: 0;
    }
    
    /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö */
    @media (max-width: 768px) {
        .card > div[style*="display: grid"] {
            grid-template-columns: 1fr !important;
        }
    }
</style>
{% endblock %}