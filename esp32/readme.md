# Инструкция по развертыванию приложения Compute Node на ESP32


## Визуальный статус LED (GPIO 2)

Бортовой светодиод на плате ESP32-S используется для индикации статуса:

* **Успешное подключение:** Медленное мигание (1 раз за 2 секунды). Происходит после успешного подключения к Wi-Fi и MQTT-брокеру. (Реализовано в `main.py`).
* **Ошибка/Потеря соединения:** Быстрое мигание (2 раза по 250 мс). Происходит при неудачной попытке подключения к сети/брокеру или при критической ошибке в главном цикле. (Реализовано в `main.py`).

## Порядок развертывания

Находясь в директории `bfdcs/esp32` выполните следующие команды:

### 1. Установка необходимых пакетов

Установите инструменты для работы с платой:
```bash
pip install esptool adafruit-ampy mpremote
```

### 2. Прошивка платы (Сброс и установка MicroPython)

> **ВНИМАНИЕ:** Во время выполнения этих команд вам может понадобиться **удерживать кнопку BOOT/FLASH** на плате.

В случае ошибки `A fatal error occurred: The chip stopped responding` запустите прошивку повторно, не отпуская клавишу.

#### 2.1 Очистка от старой информации:
```bash
esptool --port COM14 erase_flash
```

#### 2.2 Прошивка MicroPython. Во избежание ошибок рекомендуется удерживать клавишу BOOT во время прошивки.
```bash
cd firmware
esptool --chip esp32 --port COM14 write_flash -z 0x1000 ESP32_GENERIC-20250911-v1.26.1.bin
```

### 3. Загрузка приложения на плату

> **ВНИМАНИЕ:** Скрипт предусмотрен для загрузки на **COM14** при подключении к Windows. Отредактируйте файл **deploy.py**, если у вас используется другой порт. Узнать актуальный можно в диспетчере устройств.

Перейдите в папку с deploy-скриптом и запустите загрузку файлов:
```bash
cd ..
python deploy.py
```

### 4. Мониторинг логов (Опционально)

После выполнения `deploy.py` код запустится автоматически. Для просмотра вывода приложения и отладки:
```bash
mpremote connect COM14 repl
```

Нажмите **Ctrl+C**, чтобы остановить скрипт. <br>
Нажмите **Ctrl+X**, чтобы выйти из mpremote.

---

## &#9881; Конфигурация

Данные о подключении к Wi-Fi и соединении с брокером хранятся в `src/config.py`.